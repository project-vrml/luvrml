## Lua 过滤器

在这个例子中，我们会展示 Lua 过滤器在 Envoy 代理中是如何使用的。 
Envoy 代理配置包括一个 Lua 过滤器，此过滤器包含了在 这个 文档中记录的两个函数，即：

+ envoy_on_request(request_handle)
+ envoy_on_response(response_handle)

### 过滤器和 Lua 支持的高层设计如下：

所有的 Lua 环境都是 每个工作线程内的。这意味着不存在真正的全局数据。在加载时创建和填充的所有全局变量都将在每个工作线程中独立展示。将来可能通过 API 添加真正的全局支持。

所有的脚本都以协程方式运行。这意味着即便它们可能执行复杂的异步任务，但它们也是按照同步的方式编写。这使得脚本实际上更容易编写。Envoy 通过一组 API 执行所有的网络/异步处理。Envoy 将适当地暂停脚本地执行，并在异步任务完成后继续执行脚本。

不要在脚本中执行阻塞操作。 Envoy API 用于所有的 IO，所以这对性能至关重要。